# Loathsxome plugin: readmore
# Author: Abhijit Menon-Sen <ams@toroid.org>
#
# Generates "Read moreâ€¦" links for posts with ^L in them (but not for
# the first post on the page, which is the one most likely to be new
# to the reader).

package loathsxome::readmore;

sub start {
    1;
}

sub story {
    my ($pkg, $post, $filename, $story, $title, $body) = @_;

    # "Read more" links for selected long posts on index views (only)
    unless ($loathsxome::post or $loathsxome::post_index == 1) {
        my $link = "$loathsxome::postlink";
        $$body =~ s{\cL.*}{<a href="$link">Read more\&hellip;</a>}sm;
    }
    $$body =~ y/\cL//d;
}

1;
